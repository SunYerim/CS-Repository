## 데드락(DeadLock, 교착 상태)

두 개 이상의 프로세스나 스레드가 서로 자원을 얻지 못해 다음 처리를 하지 못하는 상태 <br>
**무한히 다음 자원을 기다리게 되는 상태를 말한다** <br>
시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생한다

<br>

**_데드락이 일어나는 경우_**

- 프로세스1이 자원1을 얻음 / 프로세스2가 자원2를 얻음
- 프로세스1은 자원2를 기다림 / 프로세스2는 자원1을 기다림

→ 현재 서로 원하는 자원이 상대방에 할당되어 있어서 두 프로세스는 무한정 wait 상태에 빠짐 == 이것이 바로 ✨**DeadLock**✨

<br>

> 💡 **_주로 발생하는 경우_** <br>
> 멀티 프로그래밍 환경에서 한정된 자원을 얻기 위해 서로 경쟁하는 상황 발생 <br>
> 한 프로세스가 자원을 요청했을 때 동시에 그 자원을 사용할 수 없는 상황이 발생할 수 있음 이때 프로세스는 대기 상태로 들어감 <br>
> 대기 상태로 들어간 프로세스들이 실행 상태로 변경될 수 없을 때 **교착 상태** 발생!

<br>

### 데드락 발생 조건

---

📢 4가지 모두 성립해야 데드락 발생! (하나라도 성립하지 않으면 데드락 문제 해결 가능)

<br>

1. **상호 배제** <br>
   자원은 한 번에 한 프로세스만 사용할 수 있음 (자원을 얻었으면 독점적으로 쓴다)

2. **점유 대기** <br>
   최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 존재해야 함

3. **비선점** <br>
   다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없음

4. **순환 대기** <br>
   프로세스의 집합에서 순환 형태로 자원을 대기하고 있어야 함

<br>

> **_3가지만 충족하면 왜 Deadlock이 발생하지 않을까?_** <br>
> 필요 조건 4가지 중 하나인 `"순환 대기"` 조건이 포함되어 있기 때문이다 <br><br>
> ✅ 상호 배제 조건이 없으면 두 개 이상의 프로세스가 동시에 자원을 사용할 수 있으므로 대기할 필요가 없어짐 <br>
> ✅ 점유 대기 조건이 없으면 자원을 요청한 프로세스는 해당 자원을 할당받지 못하고 바로 실패하게 되므로 대기할 필요가 없어짐 <br>
> ✅ 비선점 조건이 없으면 다른 프로세스가 자원을 강제로 해제할 수 있으므로 프로세스들이 서로 계속해서 자원을 해제하고 점유할 수 있게 됨

<br>

### 데드락 처리

---

1. **예방** <br>
   교착 상태 발생 조건 중 하나를 제거하면서 해결한다 → <u> 자원 낭비 엄청 심하다</u>
2. **회피** <br>
   교착 상태 발생 시 피해나가는 방법
   - **은행원 알고리즘** <br>
     프로세스가 자원을 요구할 때, 시스템은 자원을 할당한 후에도 안정 상태로 남아있게 되는지 사전에 검사하여 교착 상태 회피
   - **자원 할당 그래프 알고리즘** <br>
     자원과 프로세스에 대해 요청 간선과 할당 간선을 적용하여 교착 상태를 회피하는 알고리즘 <br>
     -> 자원 요구 시 **요청 간선을 할당 간선으로 변경했을 때 사이클이 생성되는지 확인**
     `사이클이 생성된다 하여 무조건 교착 상태인 것은 아니다!`
     - 자원에 하나의 인스턴스만 존재 시 교착 상태로 판별
     - 자원에 여러 인스턴스가 존재 시 교착 상태 가능성으로 판별
3. **탐지** <br>
   자원 할당 그래프를 통해 교착 상태를 탐지 <br>
   자원 요청 시 탐지 알고리즘을 실행시켜 그에 대한 오버헤드 발생
4. **회복** <br>
   교착 상태 일으킨 프로세스를 종료하거나 할당된 자원을 해제시켜 회복시키는 방법

<br>

### 추가

---

> **_기아 상태_** <br>
> 특정 프로세스의 우선순위가 낮아서 원하는 자원을 할당 받지 못하는 상태를 말한다. <br><br>
> 👉 **교착상태** : 여러 프로세스가 동일 자원 점유를 요청할 때 발생 <br>
> 👉 **기아상태** : 여러 프로세스가 부족한 자원을 점유하기 위해 경쟁할 때 발생
> <br><br>
> 기아상태는 주로 다음과 같은 방법으로 해결한다 <br>
> ✅ 프로세스 우선순위 수시 변경을 통해 각 프로세스를 높은 우선순위를 가지도록 기회 부여 <br>
> ✅ 오래 기다린 프로세스의 우선 순위 높이기 <br>
> ✅ 우선순위가 아닌 요청 순서대로 처리하는 요청큐 사용

<br><br>

### 면접 예상 질문

---

<details>
<summary>교착상태의 해결방법에 대해 설명해보세요.</summary>
<br>
교착상태는 서로 다른 프로세스가 서로 점유하고 있는 자원의 반납을 대기하고 있는 상태를 의미합니다.
<br><br>
교착상태는 상호 배제, 점유 대기, 비선점, 순환 대기 4가지 모두 성립해야 발생하기 때문에 4가지 중 하나라도 만족되지 않도록 합니다. 또한 교착 상태를 일으킨 프로세스를 종료하거나 할당된 자원을 해제시킬 수 있습니다.
<br><br>
추가적으로 은행원 알고리즘이나 자원 할당 그래프 알고리즘을 통해 회피할 수 있습니다.

</details>

<br><br>

**[참고]**

- https://velog.io/@underlier12/OS-24-%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9C%EC%99%80-%EA%B8%B0%EC%95%84%EC%83%81%ED%83%9C
- https://peonyf.tistory.com/entry/OS-DeadLock%EB%8D%B0%EB%93%9C%EB%9D%BD
